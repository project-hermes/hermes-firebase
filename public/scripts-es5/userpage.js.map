{"version":3,"sources":["../scripts/userpage.js"],"names":["window","hermesApp","UserPage","database","firebase","auth","$","document","ready","userPage","userAvatar","toast","userUsername","userInfoContainer","followContainer","noPosts","followLabel","followCheckbox","blockContainer","blockLabel","blockCheckbox","nbPostsContainer","nbFollowers","nbFollowing","nbFollowingContainer","followingContainer","nextPageButton","closeFollowingButton","userInfoPageImageContainer","change","onFollowChange","onBlockChange","onAuthStateChanged","trackFollowStatus","trackBlockStatus","click","displayFollowing","hide","removeClass","checked","prop","toggleFollowUser","userId","toggleBlockUser","currentUser","registerToFollowStatusUpdate","data","val","text","MaterialUtils","refreshSwitchState","registerToBlockedStatusUpdate","posts","postIds","Object","keys","i","length","append","createImageCard","thumb_url","url","nextPage","show","unbind","then","addPosts","entries","toggleNextPageButton","clear","uid","messaging","enableNotificationsContainer","enableNotificationsCheckbox","trackNotificationsEnabledStatus","loadUserProfile","userInfo","snapshot","css","profile_picture","full_name","message","timeout","MaterialSnackbar","showSnackbar","page","registerForFollowersCount","registerForFollowingCount","nbFollowed","registerForPostsCount","nbPosts","getUserFeedPosts","subscribeToUserFeed","postId","postValue","prepend","registerForPostsDeletion","remove","getFollowingProfiles","profiles","forEach","createProfileCardHtml","addClass","cancelAllSubscriptions","stopOnEndScrolls","thumbUrl","element","replace","registerForLikesCount","nbLikes","registerForCommentsCount","nbComments","profilePic","fullName"],"mappings":"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","file":"userpage.js","sourcesContent":["'use strict';\n\nwindow.hermesApp = window.hermesApp || {};\n\n/**\n * Handles the User Profile UI.\n */\nhermesApp.UserPage = class {\n\n  /**\n   * Initializes the user's profile UI.\n   * @constructor\n   */\n  constructor() {\n    // Firebase SDK.\n    this.database = firebase.database();\n    this.auth = firebase.auth();\n\n    $(document).ready(() => {\n      // DOM Elements.\n      this.userPage = $('#page-user-info');\n      this.userAvatar = $('.hm-user-avatar');\n      this.toast = $('.mdl-js-snackbar');\n      this.userUsername = $('.hm-user-username');\n      this.userInfoContainer = $('.hm-user-container');\n      this.followContainer = $('.hm-follow');\n      this.noPosts = $('.hm-no-posts', this.userPage);\n      this.followLabel = $('.mdl-switch__label', this.followContainer);\n      this.followCheckbox = $('#follow');\n      this.blockContainer = $('.hm-block');\n      this.blockLabel = $('.mdl-switch__label', this.blockContainer);\n      this.blockCheckbox = $('#block');\n      this.nbPostsContainer = $('.hm-user-nbposts', this.userPage);\n      this.nbFollowers = $('.hm-user-nbfollowers', this.userPage);\n      this.nbFollowing = $('.hm-user-nbfollowing', this.userPage);\n      this.nbFollowingContainer = $('.hm-user-nbfollowing-container', this.userPage);\n      this.followingContainer = $('.hm-user-following', this.userPage);\n      this.nextPageButton = $('.hm-next-page-button button');\n      this.closeFollowingButton = $('.hm-close-following', this.userPage);\n      this.userInfoPageImageContainer = $('.hm-image-container', this.userPage);\n\n      // Event bindings.\n      this.followCheckbox.change(() => this.onFollowChange());\n      this.blockCheckbox.change(() => this.onBlockChange());\n      this.auth.onAuthStateChanged(() => this.trackFollowStatus());\n      this.auth.onAuthStateChanged(() => this.trackBlockStatus());\n      this.nbFollowingContainer.click(() => this.displayFollowing());\n      this.closeFollowingButton.click(() => {\n        this.followingContainer.hide();\n        this.nbFollowingContainer.removeClass('is-active');\n      });\n    });\n  }\n\n  /**\n   * Triggered when the user changes the \"Follow\" checkbox.\n   */\n  onFollowChange() {\n    const checked = this.followCheckbox.prop('checked');\n    this.followCheckbox.prop('disabled', true);\n\n    hermesApp.firebase.toggleFollowUser(this.userId, checked);\n  }\n\n  /**\n   * Triggered when the user changes the \"Block\" checkbox.\n   */\n  onBlockChange() {\n    const checked = this.blockCheckbox.prop('checked');\n    this.blockCheckbox.prop('disabled', true);\n\n    hermesApp.firebase.toggleBlockUser(this.userId, checked);\n  }\n\n  /**\n   * Starts tracking the \"Follow\" checkbox status.\n   */\n  trackFollowStatus() {\n    if (this.auth.currentUser) {\n      hermesApp.firebase.registerToFollowStatusUpdate(this.userId, data => {\n        this.followCheckbox.prop('checked', data.val() !== null);\n        this.followCheckbox.prop('disabled', false);\n        this.followLabel.text(data.val() ? 'Following' : 'Follow');\n        hermesApp.MaterialUtils.refreshSwitchState(this.followContainer);\n      });\n    }\n  }\n\n  /**\n   * Starts tracking the \"Blocked\" checkbox status.\n   */\n  trackBlockStatus() {\n    if (this.auth.currentUser) {\n      hermesApp.firebase.registerToBlockedStatusUpdate(this.userId, data => {\n        this.blockCheckbox.prop('checked', data.val() !== null);\n        this.blockCheckbox.prop('disabled', false);\n        this.blockLabel.text(data.val() ? 'Blocked' : 'Block');\n        hermesApp.MaterialUtils.refreshSwitchState(this.blockContainer);\n      });\n    }\n  }\n\n  /**\n   * Adds the list of posts to the UI.\n   */\n  addPosts(posts) {\n    const postIds = Object.keys(posts);\n    for (let i = postIds.length - 1; i >= 0; i--) {\n      this.userInfoPageImageContainer.append(\n          hermesApp.UserPage.createImageCard(postIds[i],\n              posts[postIds[i]].thumb_url || posts[postIds[i]].url, posts[postIds[i]].text));\n      this.noPosts.hide();\n    }\n  }\n\n  /**\n   * Shows the \"load next page\" button and binds it the `nextPage` callback. If `nextPage` is `null`\n   * then the button is hidden.\n   */\n  toggleNextPageButton(nextPage) {\n    if (nextPage) {\n      this.nextPageButton.show();\n      this.nextPageButton.unbind('click');\n      this.nextPageButton.prop('disabled', false);\n      this.nextPageButton.click(() => {\n        this.nextPageButton.prop('disabled', true);\n        nextPage().then(data => {\n          this.addPosts(data.entries);\n          this.toggleNextPageButton(data.nextPage);\n        });\n      });\n    } else {\n      this.nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Displays the given user information in the UI.\n   */\n  loadUser(userId) {\n    this.userId = userId;\n\n    // Reset the UI.\n    this.clear();\n\n    // If users is the currently signed-in user we hide the \"Follow\" checkbox and the opposite for\n    // the \"Notifications\" checkbox.\n    if (this.auth.currentUser && userId === this.auth.currentUser.uid) {\n      this.followContainer.hide();\n      this.blockContainer.hide();\n      hermesApp.messaging.enableNotificationsContainer.show();\n      hermesApp.messaging.enableNotificationsCheckbox.prop('disabled', true);\n      hermesApp.MaterialUtils.refreshSwitchState(hermesApp.messaging.enableNotificationsContainer);\n      hermesApp.messaging.trackNotificationsEnabledStatus();\n    } else {\n      hermesApp.messaging.enableNotificationsContainer.hide();\n      this.followContainer.show();\n      this.followCheckbox.prop('disabled', true);\n      this.blockContainer.show();\n      this.blockContainer.prop('disabled', true);\n      hermesApp.MaterialUtils.refreshSwitchState(this.followContainer);\n      // Start live tracking the state of the \"Follow\" Checkbox.\n      this.trackFollowStatus();\n      // Start live tracking the state of the \"Block\" Checkbox.\n      this.trackBlockStatus();\n    }\n\n    // Load user's profile.\n    hermesApp.firebase.loadUserProfile(userId).then(snapshot => {\n      const userInfo = snapshot.val();\n      if (userInfo) {\n        this.userAvatar.css('background-image',\n            `url(\"${userInfo.profile_picture || '/images/silhouette.jpg'}\")`);\n        this.userUsername.text(userInfo.full_name || 'Anonymous');\n        this.userInfoContainer.show();\n      } else {\n        var data = {\n          message: 'This user does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        page(`/feed`);\n      }\n    });\n\n    // Lod user's number of followers.\n    hermesApp.firebase.registerForFollowersCount(userId,\n        nbFollowers => this.nbFollowers.text(nbFollowers));\n\n    // Lod user's number of followed users.\n    hermesApp.firebase.registerForFollowingCount(userId,\n        nbFollowed => this.nbFollowing.text(nbFollowed));\n\n    // Lod user's number of posts.\n    hermesApp.firebase.registerForPostsCount(userId,\n        nbPosts => this.nbPostsContainer.text(nbPosts));\n\n    // Display user's posts.\n    hermesApp.firebase.getUserFeedPosts(userId).then(data => {\n      const postIds = Object.keys(data.entries);\n      if (postIds.length === 0) {\n        this.noPosts.show();\n      }\n      hermesApp.firebase.subscribeToUserFeed(userId,\n        (postId, postValue) => {\n          this.userInfoPageImageContainer.prepend(\n              hermesApp.UserPage.createImageCard(postId,\n                  postValue.thumb_url || postValue.url, postValue.text));\n          this.noPosts.hide();\n        }, postIds[postIds.length - 1]);\n\n      // Adds fetched posts and next page button if necessary.\n      this.addPosts(data.entries);\n      this.toggleNextPageButton(data.nextPage);\n    });\n\n    // Listen for posts deletions.\n    hermesApp.firebase.registerForPostsDeletion(postId =>\n        $(`.hm-post-${postId}`, this.userPage).remove());\n  }\n\n  /**\n   * Displays the list of followed people.\n   */\n  displayFollowing() {\n    hermesApp.firebase.getFollowingProfiles(this.userId).then(profiles => {\n      // Clear previous following list.\n      $('.hm-usernamelink', this.followingContainer).remove();\n      // Display all following profile cards.\n      Object.keys(profiles).forEach(uid => this.followingContainer.prepend(\n          hermesApp.UserPage.createProfileCardHtml(\n              uid, profiles[uid].profile_picture, profiles[uid].full_name)));\n      if (Object.keys(profiles).length > 0) {\n        this.followingContainer.show();\n        // Mark submenu as active.\n        this.nbFollowingContainer.addClass('is-active');\n      }\n    });\n  }\n\n  /**\n   * Clears the UI and listeners.\n   */\n  clear() {\n    // Removes all pics.\n    $('.hm-image', this.userInfoPageImageContainer).remove();\n\n    // Remove active states of sub menu selectors (like \"Following\").\n    $('.is-active', this.userInfoPageImageContainer).removeClass('is-active');\n\n    // Cancel all Firebase listeners.\n    hermesApp.firebase.cancelAllSubscriptions();\n\n    // Hides the \"Load Next Page\" button.\n    this.nextPageButton.hide();\n\n    // Hides the user info box.\n    this.userInfoContainer.hide();\n\n    // Hide and empty the list of Followed people.\n    this.followingContainer.hide();\n    $('.hm-usernamelink', this.followingContainer).remove();\n\n    // Stops then infinite scrolling listeners.\n    hermesApp.MaterialUtils.stopOnEndScrolls();\n\n    // Hide the \"No posts\" message.\n    this.noPosts.hide();\n  }\n\n  /**\n   * Returns an image Card element for the image with the given URL.\n   */\n  static createImageCard(postId, thumbUrl, text) {\n    const element = $(`\n          <a href=\"/post/${postId}\" class=\"hm-post-${postId} hm-image mdl-cell mdl-cell--12-col mdl-cell--4-col-tablet\n                                            mdl-cell--4-col-desktop mdl-grid mdl-grid--no-spacing\">\n              <div class=\"hm-overlay\">\n                  <i class=\"material-icons\">favorite</i><span class=\"likes\">0</span>\n                  <i class=\"material-icons\">mode_comment</i><span class=\"comments\">0</span>\n                  <div class=\"hm-pic-text\">${text}</div>\n              </div>\n              <div class=\"mdl-card mdl-shadow--2dp mdl-cell\n                          mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop\"></div>\n          </a>`);\n    // Display the thumbnail.\n    $('.mdl-card', element).css('background-image', `url(\"${thumbUrl.replace(/\"/g, '\\\\\"')}\")`);\n    // Start listening for comments and likes counts.\n    hermesApp.firebase.registerForLikesCount(postId,\n        nbLikes => $('.likes', element).text(nbLikes));\n    hermesApp.firebase.registerForCommentsCount(postId,\n        nbComments => $('.comments', element).text(nbComments));\n\n    return element;\n  }\n\n  /**\n   * Returns an image Card element for the image with the given URL.\n   */\n  static createProfileCardHtml(uid, profilePic = '/images/silhouette.jpg', fullName = 'Anonymous') {\n    return `\n        <a class=\"hm-usernamelink mdl-button mdl-js-button\" href=\"/user/${uid}\">\n            <div class=\"hm-avatar\" style=\"background-image: url('${profilePic}')\"></div>\n            <div class=\"hm-username mdl-color-text--black\">${fullName}</div>\n        </a>`;\n  }\n};\n\nhermesApp.userPage = new hermesApp.UserPage();\n"]}