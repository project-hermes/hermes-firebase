{"version":3,"sources":["../scripts/routing.js"],"names":["window","hermesApp","Router","$","document","ready","pagesElements","splashLogin","location","pathname","page","pipe","displayPage","bind","loadUser","userPage","userId","showHomeFeed","feed","showGeneralFeed","clearFeed","clear","showDive","dive","loadDive","diveId","pageId","onlyAuthed","admin","attributes","context","enableAdminMode","disableAdminMode","auth","waitForAuth","then","_displayPage","firebase","currentUser","show","setLinkAsActive","canonicalPath","each","index","element","id","fadeOut","hide","MaterialUtils","closeDrawer","scrollToTop","path","body","classList","add","remove","animate","scrollTop","funct","attribute","optContinue","next","params","Object","keys","length","removeClass","addClass","router"],"mappings":"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","file":"routing.js","sourcesContent":["'use strict';\n\nwindow.hermesApp = window.hermesApp || {};\n\n/**\n * Handles the pages/routing.\n */\nhermesApp.Router = class {\n\n  /**\n   * Initializes controller/router.\n   * @constructor\n   */\n  constructor() {\n    $(document).ready(() => {\n      // Dom elements.\n      this.pagesElements = $('[id^=page-]');\n      this.splashLogin = $('#login', '#page-splash');\n\n      // Make sure /add is never opened on website load.\n      if (window.location.pathname === '/add') {\n        page('/');\n      }\n\n      // Configuring routes.\n      const pipe = hermesApp.Router.pipe;\n      const displayPage = this.displayPage.bind(this);\n      const loadUser = userId => hermesApp.userPage.loadUser(userId);\n      const showHomeFeed = () => hermesApp.feed.showHomeFeed();\n      const showGeneralFeed = () => hermesApp.feed.showGeneralFeed();\n      const clearFeed = () => hermesApp.feed.clear();\n      const showDive = diveId => hermesApp.dive.loadDive(diveId);\n\n      page('/', pipe(showHomeFeed, null, true),\n          pipe(displayPage, {pageId: 'feed', onlyAuthed: true}));\n      page('/feed', pipe(showGeneralFeed, null, true), pipe(displayPage, {pageId: 'feed'}));\n      page('/dive/:diveId', pipe(showDive, null, true), pipe(displayPage, {pageId: 'dive'}));\n      page('/dive/:diveId/admin', pipe(showDive, null, true), pipe(displayPage, {pageId: 'dive', admin: true}));\n      page('/user/:userId', pipe(loadUser, null, true), pipe(displayPage, {pageId: 'user-info'}));\n      page('/about', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'about'}));\n      page('/help', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'help'}));\n      page('/add', pipe(displayPage, {pageId: 'add', onlyAuthed: true}));\n      page('*', () => page('/'));\n\n      // Start routing.\n      page();\n    });\n  }\n\n  /**\n   * Returns a function that displays the given page and hides the other ones.\n   * if `onlyAuthed` is set to true then the splash page will be displayed instead of the page if\n   * the user is not signed-in.\n   */\n  displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    const admin = attributes.admin;\n    if (admin) {\n      hermesApp.Router.enableAdminMode();\n    } else {\n      hermesApp.Router.disableAdminMode();\n    }\n\n    if (onlyAuthed) {\n      // If the pge can only be displayed if the user is authenticated then we wait or the auth state.\n      hermesApp.auth.waitForAuth.then(() => {\n        this._displayPage(attributes, context);\n      });\n    } else {\n      this._displayPage(attributes, context);\n    }\n  }\n\n  _displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    let pageId = attributes.pageId;\n\n    if (onlyAuthed && !firebase.auth().currentUser) {\n      pageId = 'splash';\n      this.splashLogin.show();\n    }\n    hermesApp.Router.setLinkAsActive(context.canonicalPath);\n    this.pagesElements.each(function(index, element) {\n      if (element.id === 'page-' + pageId) {\n        $(element).show();\n      } else if (element.id === 'page-splash' && onlyAuthed) {\n        $(element).fadeOut(1000);\n      } else {\n        $(element).hide();\n      }\n    });\n    hermesApp.MaterialUtils.closeDrawer();\n    hermesApp.Router.scrollToTop();\n  }\n\n  /**\n   * Reloads the current page.\n   */\n  reloadPage() {\n    let path = window.location.pathname;\n    if (path === '') {\n      path = '/';\n    }\n    page(path);\n  }\n\n  /**\n   * Turn the UI into admin mode.\n   */\n  static enableAdminMode() {\n    document.body.classList.add('hm-admin');\n  }\n\n  /**\n   * Switch off admin mode in the UI.\n   */\n  static disableAdminMode() {\n    document.body.classList.remove('hm-admin');\n  }\n\n  /**\n   * Scrolls the page to top.\n   */\n  static scrollToTop() {\n    $('html,body').animate({scrollTop: 0}, 0);\n  }\n\n  /**\n   * Pipes the given function and passes the given attribute and Page.js context.\n   * Set 'optContinue' to true if there are further functions to call.\n   */\n  static pipe(funct, attribute, optContinue) {\n    return (context, next) => {\n      if (funct) {\n        const params = Object.keys(context.params);\n        if (!attribute && params.length > 0) {\n          funct(context.params[params[0]], context);\n        } else {\n          funct(attribute, context);\n        }\n      }\n      if (optContinue) {\n        next();\n      }\n    };\n  }\n\n  /**\n   * Highlights the correct menu item/link.\n   */\n  static setLinkAsActive(canonicalPath) {\n    if (canonicalPath === '') {\n      canonicalPath = '/';\n    }\n    $('.is-active').removeClass('is-active');\n    $(`[href=\"${canonicalPath}\"]`).addClass('is-active');\n  }\n};\n\nhermesApp.router = new hermesApp.Router();\n"]}