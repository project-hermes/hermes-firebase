{"version":3,"sources":["../scripts/dive.js"],"names":["window","hermesApp","Dive","diveId","timers","database","firebase","storage","auth","$","document","ready","divePage","diveElement","createDiveHtml","MaterialUtils","upgradeTextFields","toast","theatre","getDiveData","get","then","doc","exists","fillDiveData","console","error","currentUser","page","uid","catch","log","forEach","clearInterval","timer","cancelAllSubscriptions","comments","commentsIds","Object","keys","i","length","displayComment","comment","commentId","prepend","newElement","createComment","author","text","userId","append","upgradeDropdowns","subscribeToComment","updatedComment","snap","val","updatedElement","element","replaceWith","remove","nextPage","nextPageButton","show","unbind","prop","click","displayComments","data","entries","displayNextPageButton","hide","thumbUrl","imageText","timestamp","thumbStorageUri","picStorageUri","picUrl","dive","attr","css","profile_picture","full_name","_setupThumb","registerForThumbChanges","_setupDate","_setupDeleteButton","_setupReportButton","_setupLikeCountAndStatus","_setupComments","off","leaveTheatreMode","keydown","e","which","replace","enterTheatreMode","getTimeText","push","setInterval","empty","getComments","commentIds","subscribeToComments","commentData","submit","preventDefault","commentText","addComment","ran","Math","floor","random","swal","title","type","showCancelButton","confirmButtonColor","confirmButtonText","closeOnConfirm","showLoaderOnConfirm","allowEscapeKey","reportDive","close","message","timeout","MaterialSnackbar","showSnackbar","addClass","removeClass","deleteDive","registerToUserLike","isliked","updateLike","registerForLikesCount","nbLikes","isOwner","html","confirm","deleteComment","reportComment","newComment","prompt","editComment","diveCreationTimestamp","millis","Date","now","ms","secs","mins","hrs","days","timeSinceCreation","timeText"],"mappings":"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","file":"dive.js","sourcesContent":["'use strict';\n\nwindow.hermesApp = window.hermesApp || {};\n\n/**\n * Handles the single dive UI.\n */\nhermesApp.Dive = class {\n  /**\n   * Initializes the single dive's UI.\n   * @constructor\n   */\n  constructor(diveId) {\n    // List of all times running on the page.\n    this.timers = [];\n\n    // Firebase SDK.\n    this.database = firebase.database();\n    this.storage = firebase.storage();\n    this.auth = firebase.auth();\n\n    $(document).ready(() => {\n      this.divePage = $('#page-dive');\n      // Pointers to DOM elements.\n      this.diveElement = $(hermesApp.Dive.createDiveHtml(diveId));\n      hermesApp.MaterialUtils.upgradeTextFields(this.diveElement);\n      this.toast = $('.mdl-js-snackbar');\n      this.theatre = $('.hm-theatre');\n    });\n  }\n\n  /**\n   * Loads the given dive's details.\n   */\n  loadDive(diveId) {\n/*    // Load the dives information.\n    hermesApp.firebase.getDiveData(diveId).then(snapshot => {\n      const dive = snapshot.val();\n      // Clear listeners and previous dive data.\n      this.clear();\n      if (!dive) {\n        const data = {\n          message: 'This dive does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        if (this.auth.currentUser) {\n          page(`/user/${this.auth.currentUser.uid}`);\n        } else {\n          page(`/feed`);\n        }\n      } else {\n        this.fillDiveData(snapshot.key, dive.thumb_url || dive.url, dive.text, dive.author,\n            dive.timestamp, dive.thumb_storage_uri, dive.full_storage_uri, dive.full_url);\n      }\n    });*/\n    hermesApp.firebase.getDiveData(diveId).get().then(function (doc) {\n      if (doc.exists) {\n        this.fillDiveData(diveId);\n      } else {\n        console.error(`Dive ${diveId} does not exist`);\n        if(this.auth.currentUser) {\n          page(`/usr/${this.auth.currentUser.uid}`);\n        } else {\n          page(`/feed`);\n        }\n      }\n    }).catch(function(error) {\n      console.log(\"Error getting dive:\", error);\n    });\n  }\n\n  /**\n   * Clears all listeners and timers in the given element.\n   */\n  clear() {\n    // Stops all timers if any.\n    this.timers.forEach(timer => clearInterval(timer));\n    this.timers = [];\n\n    // Remove Firebase listeners.\n    hermesApp.firebase.cancelAllSubscriptions();\n  }\n\n  /**\n   * Displays the given list of `comments` in the dive.\n   */\n  displayComments(diveId, comments) {\n    const commentsIds = Object.keys(comments);\n    for (let i = commentsIds.length - 1; i >= 0; i--) {\n      this.displayComment(comments[commentsIds[i]], diveId, commentsIds[i]);\n    }\n  }\n\n  /**\n   * Displays a single comment or replace the existing one with new content.\n   */\n  displayComment(comment, diveId, commentId, prepend = true) {\n    const newElement = this.createComment(comment.author, comment.text, diveId,\n        commentId, comment.author.uid === hermesApp.auth.userId);\n    if (prepend) {\n      $('.hm-comments', this.diveElement).prepend(newElement);\n    } else {\n      $('.hm-comments', this.diveElement).append(newElement);\n    }\n    hermesApp.MaterialUtils.upgradeDropdowns(this.diveElement);\n\n    // Subscribe to updates of the comment.\n    hermesApp.firebase.subscribeToComment(diveId, commentId, snap => {\n      const updatedComment = snap.val();\n      if (updatedComment) {\n        const updatedElement = this.createComment(updatedComment.author,\n          updatedComment.text, diveId, commentId,\n          updatedComment.author.uid === hermesApp.auth.userId);\n        const element = $('#comment-' + commentId);\n        element.replaceWith(updatedElement);\n      } else {\n        $('#comment-' + commentId).remove();\n      }\n      hermesApp.MaterialUtils.upgradeDropdowns(this.diveElement);\n    });\n  }\n\n  /**\n   * Shows the \"show more comments\" button and binds it the `nextPage` callback. If `nextPage` is\n   * `null` then the button is hidden.\n   */\n  displayNextPageButton(diveId, nextPage) {\n    const nextPageButton = $('.hm-morecomments', this.diveElement);\n    if (nextPage) {\n      nextPageButton.show();\n      nextPageButton.unbind('click');\n      nextPageButton.prop('disabled', false);\n      nextPageButton.click(() => nextPage().then(data => {\n        nextPageButton.prop('disabled', true);\n        this.displayComments(diveId, data.entries);\n        this.displayNextPageButton(diveId, data.nextPage);\n      }));\n    } else {\n      nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Fills the dive's Card with the given details.\n   * Also sets all auto updates and listeners on the UI elements of the dive.\n   */\n  fillDiveData(diveId, thumbUrl, imageText, author = {}, timestamp, thumbStorageUri, picStorageUri, picUrl) {\n    const dive = this.diveElement;\n\n    hermesApp.MaterialUtils.upgradeDropdowns(this.diveElement);\n\n    // Fills element's author profile.\n    $('.hm-usernamelink', dive).attr('href', `/user/${author.uid}`);\n    $('.hm-avatar', dive).css('background-image',\n        `url(${author.profile_picture || '/images/silhouette.jpg'})`);\n    $('.hm-username', dive).text(author.full_name || 'Anonymous');\n\n    // Shows the pic's thumbnail.\n    this._setupThumb(thumbUrl, picUrl);\n\n    // Make sure we update if the thumb or pic URL changes.\n    hermesApp.firebase.registerForThumbChanges(diveId, thumbUrl => {\n      this._setupThumb(thumbUrl, picUrl);\n    });\n\n    this._setupDate(diveId, timestamp);\n    this._setupDeleteButton(diveId, author, picStorageUri, thumbStorageUri);\n    this._setupReportButton(diveId);\n    this._setupLikeCountAndStatus(diveId);\n    this._setupComments(diveId, author, imageText);\n    return dive;\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  leaveTheatreMode() {\n    this.theatre.hide();\n    this.theatre.off('click');\n    $(document).off('keydown');\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  enterTheatreMode(picUrl) {\n    $('.hm-fullpic', this.theatre).prop('src', picUrl);\n    this.theatre.css('display', 'flex');\n    // Leave theatre mode if click or ESC key down.\n    this.theatre.off('click');\n    this.theatre.click(() => this.leaveTheatreMode());\n    $(document).off('keydown');\n    $(document).keydown(e => {\n      if (e.which === 27) {\n        this.leaveTheatreMode();\n      }\n    });\n  }\n\n  /**\n   * Shows the thumbnail and sets up the click to see the full size image.\n   * @private\n   */\n  _setupThumb(thumbUrl, picUrl) {\n    const dive = this.diveElement;\n\n    $('.hm-image', dive).css('background-image', `url(\"${thumbUrl ? thumbUrl.replace(/\"/g, '\\\\\"') : ''}\")`);\n    $('.hm-image', dive).unbind('click');\n    $('.hm-image', dive).click(() => this.enterTheatreMode(picUrl || thumbUrl));\n  }\n\n  /**\n   * Shows the publishing date of the dive and updates this date live.\n   * @private\n   */\n  _setupDate(diveId, timestamp) {\n    const dive = this.diveElement;\n\n    $('.hm-time', dive).attr('href', `/dive/${diveId}`);\n    $('.hm-time', dive).text(hermesApp.Dive.getTimeText(timestamp));\n    // Update the time counter every minutes.\n    this.timers.push(setInterval(\n        () => $('.hm-time', dive).text(hermesApp.Dive.getTimeText(timestamp)), 60000));\n  }\n\n  /**\n   * Shows comments and binds actions to the comments form.\n   * @private\n   */\n  _setupComments(diveId, author, imageText) {\n    const dive = this.diveElement;\n\n    // Creates the initial comment with the dive's text.\n    $('.hm-first-comment', dive).empty();\n    $('.hm-first-comment', dive).append(this.createComment(author, imageText));\n\n    // Load first page of comments and listen to new comments.\n    hermesApp.firebase.getComments(diveId).then(data => {\n      $('.hm-comments', dive).empty();\n      this.displayComments(diveId, data.entries);\n      this.displayNextPageButton(diveId, data.nextPage);\n\n      // Display any new comments.\n      const commentIds = Object.keys(data.entries);\n      hermesApp.firebase.subscribeToComments(diveId, (commentId, commentData) => {\n        this.displayComment(commentData, diveId, commentId, false);\n      }, commentIds ? commentIds[commentIds.length - 1] : 0);\n    });\n\n    if (this.auth.currentUser) {\n      // Bind comments form diveing.\n      $('.hm-add-comment', dive).off('submit');\n      $('.hm-add-comment', dive).submit(e => {\n        e.preventDefault();\n        const commentText = $(`.mdl-textfield__input`, dive).val();\n        if (!commentText || commentText.length === 0) {\n          return;\n        }\n        hermesApp.firebase.addComment(diveId, commentText);\n        $(`.mdl-textfield__input`, dive).val('');\n      });\n      const ran = Math.floor(Math.random() * 10000000);\n      $('.mdl-textfield__input', dive).attr('id', `${diveId}-${ran}-comment`);\n      $('.mdl-textfield__label', dive).attr('for', `${diveId}-${ran}-comment`);\n      // Show comments form.\n      $('.hm-action', dive).css('display', 'flex');\n    }\n  }\n\n  /**\n   * Binds the action to the report button.\n   * @private\n   */\n  _setupReportButton(diveId) {\n    const dive = this.diveElement;\n\n    if (this.auth.currentUser) {\n      $('.hm-report-dive', dive).show();\n      $('.hm-report-dive', dive).off('click');\n      $('.hm-report-dive', dive).click(() => {\n        swal({\n          title: 'Are you sure?',\n          text: 'You are about to flag this dive for inappropriate content! An administrator will review your claim.',\n          type: 'warning',\n          showCancelButton: true,\n          confirmButtonColor: '#DD6B55',\n          confirmButtonText: 'Yes, report this dive!',\n          closeOnConfirm: true,\n          showLoaderOnConfirm: true,\n          allowEscapeKey: true\n        }, () => {\n          $('.hm-report-dive', dive).prop('disabled', true);\n          hermesApp.firebase.reportDive(diveId).then(() => {\n            swal({\n              title: 'Reported!',\n              text: 'This dive has been reported. Please allow some time before an admin reviews it.',\n              type: 'success',\n              timer: 2000\n            });\n            $('.hm-report-dive', dive).prop('disabled', false);\n          }).catch(error => {\n            swal.close();\n            $('.hm-report-dive', dive).prop('disabled', false);\n            const data = {\n              message: `There was an error reporting your dive: ${error}`,\n              timeout: 5000\n            };\n            this.toast[0].MaterialSnackbar.showSnackbar(data);\n          });\n        });\n      });\n    }\n  }\n\n  /**\n   * Shows/Hide and binds actions to the Delete button.\n   * @private\n   */\n  _setupDeleteButton(diveId, author = {}, picStorageUri, thumbStorageUri) {\n    const dive = this.diveElement;\n\n    if (this.auth.currentUser && this.auth.currentUser.uid === author.uid) {\n      dive.addClass('hm-owned-dive');\n    } else {\n      dive.removeClass('hm-owned-dive');\n    }\n\n    $('.hm-delete-dive', dive).off('click');\n    $('.hm-delete-dive', dive).click(() => {\n      swal({\n        title: 'Are you sure?',\n        text: 'You are about to delete this dive. Once deleted, you will not be able to recover it!',\n        type: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#DD6B55',\n        confirmButtonText: 'Yes, delete it!',\n        closeOnConfirm: false,\n        showLoaderOnConfirm: true,\n        allowEscapeKey: true\n      }, () => {\n        $('.hm-delete-dive', dive).prop('disabled', true);\n        hermesApp.firebase.deleteDive(diveId, picStorageUri, thumbStorageUri).then(() => {\n          swal({\n            title: 'Deleted!',\n            text: 'Your dive has been deleted.',\n            type: 'success',\n            timer: 2000\n          });\n          $('.hm-delete-dive', dive).prop('disabled', false);\n          page(`/user/${this.auth.currentUser.uid}`);\n        }).catch(error => {\n          swal.close();\n          $('.hm-delete-dive', dive).prop('disabled', false);\n          const data = {\n            message: `There was an error deleting your dive: ${error}`,\n            timeout: 5000\n          };\n          this.toast[0].MaterialSnackbar.showSnackbar(data);\n        });\n      });\n    });\n  }\n\n  /**\n   * Starts Likes count listener and on/off like status.\n   * @private\n   */\n  _setupLikeCountAndStatus(diveId) {\n    const dive = this.diveElement;\n\n    if (this.auth.currentUser) {\n      // Listen to like status.\n      hermesApp.firebase.registerToUserLike(diveId, isliked => {\n        if (isliked) {\n          $('.hm-liked', dive).show();\n          $('.hm-not-liked', dive).hide();\n        } else {\n          $('.hm-liked', dive).hide();\n          $('.hm-not-liked', dive).show();\n        }\n      });\n\n      // Add event listeners.\n      $('.hm-liked', dive).off('click');\n      $('.hm-liked', dive).click(() => hermesApp.firebase.updateLike(diveId, false));\n      $('.hm-not-liked', dive).off('click');\n      $('.hm-not-liked', dive).click(() => hermesApp.firebase.updateLike(diveId, true));\n    } else {\n      $('.hm-liked', dive).hide();\n      $('.hm-not-liked', dive).hide();\n      $('.hm-action', dive).hide();\n    }\n\n    // Listen to number of Likes.\n    hermesApp.firebase.registerForLikesCount(diveId, nbLikes => {\n      if (nbLikes > 0) {\n        $('.hm-likes', dive).show();\n        $('.hm-likes', dive).text(nbLikes + ' like' + (nbLikes === 1 ? '' : 's'));\n      } else {\n        $('.hm-likes', dive).hide();\n      }\n    });\n  }\n\n  /**\n   * Returns the HTML for a dive's comment.\n   */\n  static createDiveHtml(diveId = 0) {\n    return `\n        <div class=\"hm-dive mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet\n                    mdl-cell--8-col-desktop mdl-grid mdl-grid--no-spacing\">\n          <div class=\"mdl-card mdl-shadow--2dp mdl-cell\n                        mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop\">\n            <div class=\"hm-header\">\n              <a class=\"hm-usernamelink mdl-button mdl-js-button\" href=\"/user/\">\n                <div class=\"hm-avatar\"></div>\n                <div class=\"hm-username mdl-color-text--black\"></div>\n              </a>\n              <a href=\"/dive/\" class=\"hm-time\">now</a>\n              <!-- Drop Down Menu -->\n              <button class=\"hm-signed-in-only mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon\" id=\"hm-dive-menu-${diveId}\">\n                <i class=\"material-icons\">more_vert</i>\n              </button>\n              <ul class=\"hm-menu-list mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right\" for=\"hm-dive-menu-${diveId}\">\n                <li class=\"mdl-menu__item hm-report-dive\"><i class=\"material-icons\">report</i> Report</li>\n                <li class=\"mdl-menu__item hm-delete-dive\"><i class=\"material-icons\">delete</i> Delete dive</li>\n              </ul>\n            </div>\n            <div class=\"hm-image\"></div>\n            <div class=\"hm-likes\">0 likes</div>\n            <div class=\"hm-first-comment\"></div>\n            <div class=\"hm-morecomments\">View more comments...</div>\n            <div class=\"hm-comments\"></div>\n            <div class=\"hm-action\">\n              <span class=\"hm-like\">\n                <div class=\"hm-not-liked material-icons\">favorite_border</div>\n                <div class=\"hm-liked material-icons\">favorite</div>\n              </span>\n              <form class=\"hm-add-comment\" action=\"#\">\n                <div class=\"mdl-textfield mdl-js-textfield\">\n                  <input class=\"mdl-textfield__input\">\n                  <label class=\"mdl-textfield__label\">Comment...</label>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>`;\n  }\n\n  /**\n   * Returns the HTML for a dive's comment.\n   */\n  createComment(author = {}, text, diveId, commentId, isOwner = false) {\n    try {\n      const element = $(`\n        <div id=\"comment-${commentId}\" class=\"hm-comment${isOwner ? ' hm-comment-owned' : ''}\">\n          <a class=\"hm-author\" href=\"/user/${author.uid}\">${$('<div>').text(author.full_name || 'Anonymous').html()}</a>:\n          <span class=\"hm-text\">${$('<div>').text(text).html()}</span>\n          <!-- Drop Down Menu -->\n          <button class=\"hm-edit-delete-comment-container hm-signed-in-only mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon\" id=\"hm-comment-menu-${commentId}\">\n            <i class=\"material-icons\">more_vert</i>\n          </button>\n          <ul class=\"hm-menu-list mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--top-right\" for=\"hm-comment-menu-${commentId}\">\n            <li class=\"mdl-menu__item hm-report-comment\"><i class=\"material-icons\">report</i> Report</li>\n            <li class=\"mdl-menu__item hm-edit-comment\"><i class=\"material-icons\">mode_edit</i> Edit</li>\n            <li class=\"mdl-menu__item hm-delete-comment\"><i class=\"material-icons\">delete</i> Delete comment</li>\n          </ul>\n        </div>`);\n      $('.hm-delete-comment', element).click(() => {\n        if (window.confirm('Delete the comment?')) {\n          hermesApp.firebase.deleteComment(diveId, commentId).then(() => {\n            element.text('this comment has been deleted');\n            element.addClass('hm-comment-deleted');\n          });\n        }\n      });\n      $('.hm-report-comment', element).click(() => {\n        if (window.confirm('Report this comment for inappropriate content?')) {\n          hermesApp.firebase.reportComment(diveId, commentId).then(() => {\n            element.text('this comment has been flagged for review.');\n            element.addClass('hm-comment-deleted');\n          });\n        }\n      });\n      $('.hm-edit-comment', element).click(() => {\n        const newComment = window.prompt('Edit the comment?', text);\n        if (newComment !== null && newComment !== '') {\n          hermesApp.firebase.editComment(diveId, commentId, newComment).then(() => {\n            $('.hm-text', element).text(newComment);\n          });\n        }\n      });\n      return element;\n    } catch (e) {\n      console.error('Error while displaying comment', e);\n    }\n    return $('<div/>');\n  }\n\n  /**\n   * Given the time of creation of a dive returns how long since the creation of the dive in text\n   * format. e.g. 5d, 10h, now...\n   */\n  static getTimeText(diveCreationTimestamp) {\n    let millis = Date.now() - diveCreationTimestamp;\n    const ms = millis % 1000;\n    millis = (millis - ms) / 1000;\n    const secs = millis % 60;\n    millis = (millis - secs) / 60;\n    const mins = millis % 60;\n    millis = (millis - mins) / 60;\n    const hrs = millis % 24;\n    const days = (millis - hrs) / 24;\n    const timeSinceCreation = [days, hrs, mins, secs, ms];\n\n    let timeText = 'Now';\n    if (timeSinceCreation[0] !== 0) {\n      timeText = timeSinceCreation[0] + 'd';\n    } else if (timeSinceCreation[1] !== 0) {\n      timeText = timeSinceCreation[1] + 'h';\n    } else if (timeSinceCreation[2] !== 0) {\n      timeText = timeSinceCreation[2] + 'm';\n    }\n    return timeText;\n  }\n};\n\nhermesApp.dive = new hermesApp.Dive();\n\n$(document).ready(() => {\n  // We add the Dive element to the single dive page.\n  $('.hm-image-container', hermesApp.dive.divePage).append(hermesApp.dive.diveElement);\n});\n"]}