{"version":3,"sources":["../scripts/dive.js"],"names":["window","hermesApp","Dive","diveId","timers","database","firebase","storage","auth","$","document","ready","divePage","diveElement","createDiveHtml","MaterialUtils","upgradeTextFields","toast","theatre","getDiveData","then","dive","snapshot","val","clear","data","message","timeout","MaterialSnackbar","showSnackbar","currentUser","page","uid","fillDiveData","key","thumb_url","url","text","author","timestamp","thumb_storage_uri","full_storage_uri","full_url","forEach","clearInterval","timer","cancelAllSubscriptions","comments","commentsIds","Object","keys","i","length","displayComment","comment","commentId","prepend","newElement","createComment","userId","append","upgradeDropdowns","subscribeToComment","updatedComment","snap","updatedElement","element","replaceWith","remove","nextPage","nextPageButton","show","unbind","prop","click","displayComments","entries","displayNextPageButton","hide","thumbUrl","imageText","thumbStorageUri","picStorageUri","picUrl","attr","css","profile_picture","full_name","_setupThumb","registerForThumbChanges","_setupDate","_setupDeleteButton","_setupReportButton","_setupLikeCountAndStatus","_setupComments","off","leaveTheatreMode","keydown","e","which","replace","enterTheatreMode","getTimeText","push","setInterval","empty","getComments","commentIds","subscribeToComments","commentData","submit","preventDefault","commentText","addComment","ran","Math","floor","random","swal","title","type","showCancelButton","confirmButtonColor","confirmButtonText","closeOnConfirm","showLoaderOnConfirm","allowEscapeKey","reportDive","catch","close","error","addClass","removeClass","deleteDive","registerToUserLike","isliked","updateLike","registerForLikesCount","nbLikes","isOwner","html","confirm","deleteComment","reportComment","newComment","prompt","editComment","console","diveCreationTimestamp","millis","Date","now","ms","secs","mins","hrs","days","timeSinceCreation","timeText"],"mappings":"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","file":"dive.js","sourcesContent":["'use strict';\n\nwindow.hermesApp = window.hermesApp || {};\n\n/**\n * Handles the single dive UI.\n */\nhermesApp.Dive = class {\n  /**\n   * Initializes the single dive's UI.\n   * @constructor\n   */\n  constructor(diveId) {\n    // List of all times running on the page.\n    this.timers = [];\n\n    // Firebase SDK.\n    this.database = firebase.database();\n    this.storage = firebase.storage();\n    this.auth = firebase.auth();\n\n    $(document).ready(() => {\n      this.divePage = $('#page-dive');\n      // Pointers to DOM elements.\n      this.diveElement = $(hermesApp.Dive.createDiveHtml(diveId));\n      hermesApp.MaterialUtils.upgradeTextFields(this.diveElement);\n      this.toast = $('.mdl-js-snackbar');\n      this.theatre = $('.hm-theatre');\n    });\n  }\n\n  /**\n   * Loads the given dive's details.\n   */\n  loadDive(diveId) {\n    // Load the dives information.\n    hermesApp.firebase.getDiveData(diveId).then(snapshot => {\n      const dive = snapshot.val();\n      // Clear listeners and previous dive data.\n      this.clear();\n      if (!dive) {\n        const data = {\n          message: 'This dive does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        if (this.auth.currentUser) {\n          page(`/user/${this.auth.currentUser.uid}`);\n        } else {\n          page(`/feed`);\n        }\n      } else {\n        this.fillDiveData(snapshot.key, dive.thumb_url || dive.url, dive.text, dive.author,\n            dive.timestamp, dive.thumb_storage_uri, dive.full_storage_uri, dive.full_url);\n      }\n    });\n  }\n\n  /**\n   * Clears all listeners and timers in the given element.\n   */\n  clear() {\n    // Stops all timers if any.\n    this.timers.forEach(timer => clearInterval(timer));\n    this.timers = [];\n\n    // Remove Firebase listeners.\n    hermesApp.firebase.cancelAllSubscriptions();\n  }\n\n  /**\n   * Displays the given list of `comments` in the dive.\n   */\n  displayComments(diveId, comments) {\n    const commentsIds = Object.keys(comments);\n    for (let i = commentsIds.length - 1; i >= 0; i--) {\n      this.displayComment(comments[commentsIds[i]], diveId, commentsIds[i]);\n    }\n  }\n\n  /**\n   * Displays a single comment or replace the existing one with new content.\n   */\n  displayComment(comment, diveId, commentId, prepend = true) {\n    const newElement = this.createComment(comment.author, comment.text, diveId,\n        commentId, comment.author.uid === hermesApp.auth.userId);\n    if (prepend) {\n      $('.hm-comments', this.diveElement).prepend(newElement);\n    } else {\n      $('.hm-comments', this.diveElement).append(newElement);\n    }\n    hermesApp.MaterialUtils.upgradeDropdowns(this.diveElement);\n\n    // Subscribe to updates of the comment.\n    hermesApp.firebase.subscribeToComment(diveId, commentId, snap => {\n      const updatedComment = snap.val();\n      if (updatedComment) {\n        const updatedElement = this.createComment(updatedComment.author,\n          updatedComment.text, diveId, commentId,\n          updatedComment.author.uid === hermesApp.auth.userId);\n        const element = $('#comment-' + commentId);\n        element.replaceWith(updatedElement);\n      } else {\n        $('#comment-' + commentId).remove();\n      }\n      hermesApp.MaterialUtils.upgradeDropdowns(this.diveElement);\n    });\n  }\n\n  /**\n   * Shows the \"show more comments\" button and binds it the `nextPage` callback. If `nextPage` is\n   * `null` then the button is hidden.\n   */\n  displayNextPageButton(diveId, nextPage) {\n    const nextPageButton = $('.hm-morecomments', this.diveElement);\n    if (nextPage) {\n      nextPageButton.show();\n      nextPageButton.unbind('click');\n      nextPageButton.prop('disabled', false);\n      nextPageButton.click(() => nextPage().then(data => {\n        nextPageButton.prop('disabled', true);\n        this.displayComments(diveId, data.entries);\n        this.displayNextPageButton(diveId, data.nextPage);\n      }));\n    } else {\n      nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Fills the dive's Card with the given details.\n   * Also sets all auto updates and listeners on the UI elements of the dive.\n   */\n  fillDiveData(diveId, thumbUrl, imageText, author = {}, timestamp, thumbStorageUri, picStorageUri, picUrl) {\n    const dive = this.diveElement;\n\n    hermesApp.MaterialUtils.upgradeDropdowns(this.diveElement);\n\n    // Fills element's author profile.\n    $('.hm-usernamelink', dive).attr('href', `/user/${author.uid}`);\n    $('.hm-avatar', dive).css('background-image',\n        `url(${author.profile_picture || '/images/silhouette.jpg'})`);\n    $('.hm-username', dive).text(author.full_name || 'Anonymous');\n\n    // Shows the pic's thumbnail.\n    this._setupThumb(thumbUrl, picUrl);\n\n    // Make sure we update if the thumb or pic URL changes.\n    hermesApp.firebase.registerForThumbChanges(diveId, thumbUrl => {\n      this._setupThumb(thumbUrl, picUrl);\n    });\n\n    this._setupDate(diveId, timestamp);\n    this._setupDeleteButton(diveId, author, picStorageUri, thumbStorageUri);\n    this._setupReportButton(diveId);\n    this._setupLikeCountAndStatus(diveId);\n    this._setupComments(diveId, author, imageText);\n    return dive;\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  leaveTheatreMode() {\n    this.theatre.hide();\n    this.theatre.off('click');\n    $(document).off('keydown');\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  enterTheatreMode(picUrl) {\n    $('.hm-fullpic', this.theatre).prop('src', picUrl);\n    this.theatre.css('display', 'flex');\n    // Leave theatre mode if click or ESC key down.\n    this.theatre.off('click');\n    this.theatre.click(() => this.leaveTheatreMode());\n    $(document).off('keydown');\n    $(document).keydown(e => {\n      if (e.which === 27) {\n        this.leaveTheatreMode();\n      }\n    });\n  }\n\n  /**\n   * Shows the thumbnail and sets up the click to see the full size image.\n   * @private\n   */\n  _setupThumb(thumbUrl, picUrl) {\n    const dive = this.diveElement;\n\n    $('.hm-image', dive).css('background-image', `url(\"${thumbUrl ? thumbUrl.replace(/\"/g, '\\\\\"') : ''}\")`);\n    $('.hm-image', dive).unbind('click');\n    $('.hm-image', dive).click(() => this.enterTheatreMode(picUrl || thumbUrl));\n  }\n\n  /**\n   * Shows the publishing date of the dive and updates this date live.\n   * @private\n   */\n  _setupDate(diveId, timestamp) {\n    const dive = this.diveElement;\n\n    $('.hm-time', dive).attr('href', `/dive/${diveId}`);\n    $('.hm-time', dive).text(hermesApp.Dive.getTimeText(timestamp));\n    // Update the time counter every minutes.\n    this.timers.push(setInterval(\n        () => $('.hm-time', dive).text(hermesApp.Dive.getTimeText(timestamp)), 60000));\n  }\n\n  /**\n   * Shows comments and binds actions to the comments form.\n   * @private\n   */\n  _setupComments(diveId, author, imageText) {\n    const dive = this.diveElement;\n\n    // Creates the initial comment with the dive's text.\n    $('.hm-first-comment', dive).empty();\n    $('.hm-first-comment', dive).append(this.createComment(author, imageText));\n\n    // Load first page of comments and listen to new comments.\n    hermesApp.firebase.getComments(diveId).then(data => {\n      $('.hm-comments', dive).empty();\n      this.displayComments(diveId, data.entries);\n      this.displayNextPageButton(diveId, data.nextPage);\n\n      // Display any new comments.\n      const commentIds = Object.keys(data.entries);\n      hermesApp.firebase.subscribeToComments(diveId, (commentId, commentData) => {\n        this.displayComment(commentData, diveId, commentId, false);\n      }, commentIds ? commentIds[commentIds.length - 1] : 0);\n    });\n\n    if (this.auth.currentUser) {\n      // Bind comments form diveing.\n      $('.hm-add-comment', dive).off('submit');\n      $('.hm-add-comment', dive).submit(e => {\n        e.preventDefault();\n        const commentText = $(`.mdl-textfield__input`, dive).val();\n        if (!commentText || commentText.length === 0) {\n          return;\n        }\n        hermesApp.firebase.addComment(diveId, commentText);\n        $(`.mdl-textfield__input`, dive).val('');\n      });\n      const ran = Math.floor(Math.random() * 10000000);\n      $('.mdl-textfield__input', dive).attr('id', `${diveId}-${ran}-comment`);\n      $('.mdl-textfield__label', dive).attr('for', `${diveId}-${ran}-comment`);\n      // Show comments form.\n      $('.hm-action', dive).css('display', 'flex');\n    }\n  }\n\n  /**\n   * Binds the action to the report button.\n   * @private\n   */\n  _setupReportButton(diveId) {\n    const dive = this.diveElement;\n\n    if (this.auth.currentUser) {\n      $('.hm-report-dive', dive).show();\n      $('.hm-report-dive', dive).off('click');\n      $('.hm-report-dive', dive).click(() => {\n        swal({\n          title: 'Are you sure?',\n          text: 'You are about to flag this dive for inappropriate content! An administrator will review your claim.',\n          type: 'warning',\n          showCancelButton: true,\n          confirmButtonColor: '#DD6B55',\n          confirmButtonText: 'Yes, report this dive!',\n          closeOnConfirm: true,\n          showLoaderOnConfirm: true,\n          allowEscapeKey: true\n        }, () => {\n          $('.hm-report-dive', dive).prop('disabled', true);\n          hermesApp.firebase.reportDive(diveId).then(() => {\n            swal({\n              title: 'Reported!',\n              text: 'This dive has been reported. Please allow some time before an admin reviews it.',\n              type: 'success',\n              timer: 2000\n            });\n            $('.hm-report-dive', dive).prop('disabled', false);\n          }).catch(error => {\n            swal.close();\n            $('.hm-report-dive', dive).prop('disabled', false);\n            const data = {\n              message: `There was an error reporting your dive: ${error}`,\n              timeout: 5000\n            };\n            this.toast[0].MaterialSnackbar.showSnackbar(data);\n          });\n        });\n      });\n    }\n  }\n\n  /**\n   * Shows/Hide and binds actions to the Delete button.\n   * @private\n   */\n  _setupDeleteButton(diveId, author = {}, picStorageUri, thumbStorageUri) {\n    const dive = this.diveElement;\n\n    if (this.auth.currentUser && this.auth.currentUser.uid === author.uid) {\n      dive.addClass('hm-owned-dive');\n    } else {\n      dive.removeClass('hm-owned-dive');\n    }\n\n    $('.hm-delete-dive', dive).off('click');\n    $('.hm-delete-dive', dive).click(() => {\n      swal({\n        title: 'Are you sure?',\n        text: 'You are about to delete this dive. Once deleted, you will not be able to recover it!',\n        type: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#DD6B55',\n        confirmButtonText: 'Yes, delete it!',\n        closeOnConfirm: false,\n        showLoaderOnConfirm: true,\n        allowEscapeKey: true\n      }, () => {\n        $('.hm-delete-dive', dive).prop('disabled', true);\n        hermesApp.firebase.deleteDive(diveId, picStorageUri, thumbStorageUri).then(() => {\n          swal({\n            title: 'Deleted!',\n            text: 'Your dive has been deleted.',\n            type: 'success',\n            timer: 2000\n          });\n          $('.hm-delete-dive', dive).prop('disabled', false);\n          page(`/user/${this.auth.currentUser.uid}`);\n        }).catch(error => {\n          swal.close();\n          $('.hm-delete-dive', dive).prop('disabled', false);\n          const data = {\n            message: `There was an error deleting your dive: ${error}`,\n            timeout: 5000\n          };\n          this.toast[0].MaterialSnackbar.showSnackbar(data);\n        });\n      });\n    });\n  }\n\n  /**\n   * Starts Likes count listener and on/off like status.\n   * @private\n   */\n  _setupLikeCountAndStatus(diveId) {\n    const dive = this.diveElement;\n\n    if (this.auth.currentUser) {\n      // Listen to like status.\n      hermesApp.firebase.registerToUserLike(diveId, isliked => {\n        if (isliked) {\n          $('.hm-liked', dive).show();\n          $('.hm-not-liked', dive).hide();\n        } else {\n          $('.hm-liked', dive).hide();\n          $('.hm-not-liked', dive).show();\n        }\n      });\n\n      // Add event listeners.\n      $('.hm-liked', dive).off('click');\n      $('.hm-liked', dive).click(() => hermesApp.firebase.updateLike(diveId, false));\n      $('.hm-not-liked', dive).off('click');\n      $('.hm-not-liked', dive).click(() => hermesApp.firebase.updateLike(diveId, true));\n    } else {\n      $('.hm-liked', dive).hide();\n      $('.hm-not-liked', dive).hide();\n      $('.hm-action', dive).hide();\n    }\n\n    // Listen to number of Likes.\n    hermesApp.firebase.registerForLikesCount(diveId, nbLikes => {\n      if (nbLikes > 0) {\n        $('.hm-likes', dive).show();\n        $('.hm-likes', dive).text(nbLikes + ' like' + (nbLikes === 1 ? '' : 's'));\n      } else {\n        $('.hm-likes', dive).hide();\n      }\n    });\n  }\n\n  /**\n   * Returns the HTML for a dive's comment.\n   */\n  static createDiveHtml(diveId = 0) {\n    return `\n        <div class=\"hm-dive mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet\n                    mdl-cell--8-col-desktop mdl-grid mdl-grid--no-spacing\">\n          <div class=\"mdl-card mdl-shadow--2dp mdl-cell\n                        mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop\">\n            <div class=\"hm-header\">\n              <a class=\"hm-usernamelink mdl-button mdl-js-button\" href=\"/user/\">\n                <div class=\"hm-avatar\"></div>\n                <div class=\"hm-username mdl-color-text--black\"></div>\n              </a>\n              <a href=\"/dive/\" class=\"hm-time\">now</a>\n              <!-- Drop Down Menu -->\n              <button class=\"hm-signed-in-only mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon\" id=\"hm-dive-menu-${diveId}\">\n                <i class=\"material-icons\">more_vert</i>\n              </button>\n              <ul class=\"hm-menu-list mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right\" for=\"hm-dive-menu-${diveId}\">\n                <li class=\"mdl-menu__item hm-report-dive\"><i class=\"material-icons\">report</i> Report</li>\n                <li class=\"mdl-menu__item hm-delete-dive\"><i class=\"material-icons\">delete</i> Delete dive</li>\n              </ul>\n            </div>\n            <div class=\"hm-image\"></div>\n            <div class=\"hm-likes\">0 likes</div>\n            <div class=\"hm-first-comment\"></div>\n            <div class=\"hm-morecomments\">View more comments...</div>\n            <div class=\"hm-comments\"></div>\n            <div class=\"hm-action\">\n              <span class=\"hm-like\">\n                <div class=\"hm-not-liked material-icons\">favorite_border</div>\n                <div class=\"hm-liked material-icons\">favorite</div>\n              </span>\n              <form class=\"hm-add-comment\" action=\"#\">\n                <div class=\"mdl-textfield mdl-js-textfield\">\n                  <input class=\"mdl-textfield__input\">\n                  <label class=\"mdl-textfield__label\">Comment...</label>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>`;\n  }\n\n  /**\n   * Returns the HTML for a dive's comment.\n   */\n  createComment(author = {}, text, diveId, commentId, isOwner = false) {\n    try {\n      const element = $(`\n        <div id=\"comment-${commentId}\" class=\"hm-comment${isOwner ? ' hm-comment-owned' : ''}\">\n          <a class=\"hm-author\" href=\"/user/${author.uid}\">${$('<div>').text(author.full_name || 'Anonymous').html()}</a>:\n          <span class=\"hm-text\">${$('<div>').text(text).html()}</span>\n          <!-- Drop Down Menu -->\n          <button class=\"hm-edit-delete-comment-container hm-signed-in-only mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon\" id=\"hm-comment-menu-${commentId}\">\n            <i class=\"material-icons\">more_vert</i>\n          </button>\n          <ul class=\"hm-menu-list mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--top-right\" for=\"hm-comment-menu-${commentId}\">\n            <li class=\"mdl-menu__item hm-report-comment\"><i class=\"material-icons\">report</i> Report</li>\n            <li class=\"mdl-menu__item hm-edit-comment\"><i class=\"material-icons\">mode_edit</i> Edit</li>\n            <li class=\"mdl-menu__item hm-delete-comment\"><i class=\"material-icons\">delete</i> Delete comment</li>\n          </ul>\n        </div>`);\n      $('.hm-delete-comment', element).click(() => {\n        if (window.confirm('Delete the comment?')) {\n          hermesApp.firebase.deleteComment(diveId, commentId).then(() => {\n            element.text('this comment has been deleted');\n            element.addClass('hm-comment-deleted');\n          });\n        }\n      });\n      $('.hm-report-comment', element).click(() => {\n        if (window.confirm('Report this comment for inappropriate content?')) {\n          hermesApp.firebase.reportComment(diveId, commentId).then(() => {\n            element.text('this comment has been flagged for review.');\n            element.addClass('hm-comment-deleted');\n          });\n        }\n      });\n      $('.hm-edit-comment', element).click(() => {\n        const newComment = window.prompt('Edit the comment?', text);\n        if (newComment !== null && newComment !== '') {\n          hermesApp.firebase.editComment(diveId, commentId, newComment).then(() => {\n            $('.hm-text', element).text(newComment);\n          });\n        }\n      });\n      return element;\n    } catch (e) {\n      console.error('Error while displaying comment', e);\n    }\n    return $('<div/>');\n  }\n\n  /**\n   * Given the time of creation of a dive returns how long since the creation of the dive in text\n   * format. e.g. 5d, 10h, now...\n   */\n  static getTimeText(diveCreationTimestamp) {\n    let millis = Date.now() - diveCreationTimestamp;\n    const ms = millis % 1000;\n    millis = (millis - ms) / 1000;\n    const secs = millis % 60;\n    millis = (millis - secs) / 60;\n    const mins = millis % 60;\n    millis = (millis - mins) / 60;\n    const hrs = millis % 24;\n    const days = (millis - hrs) / 24;\n    const timeSinceCreation = [days, hrs, mins, secs, ms];\n\n    let timeText = 'Now';\n    if (timeSinceCreation[0] !== 0) {\n      timeText = timeSinceCreation[0] + 'd';\n    } else if (timeSinceCreation[1] !== 0) {\n      timeText = timeSinceCreation[1] + 'h';\n    } else if (timeSinceCreation[2] !== 0) {\n      timeText = timeSinceCreation[2] + 'm';\n    }\n    return timeText;\n  }\n};\n\nhermesApp.dive = new hermesApp.Dive();\n\n$(document).ready(() => {\n  // We add the Dive element to the single dive page.\n  $('.hm-image-container', hermesApp.dive.divePage).append(hermesApp.dive.diveElement);\n});\n"]}