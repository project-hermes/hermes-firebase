{"version":3,"sources":["../scripts/search.js"],"names":["window","hermesApp","Search","database","firebase","$","document","ready","searchField","searchResults","keyup","displaySearchResults","focus","click","searchString","val","toLowerCase","trim","length","MIN_CHARACTERS","searchUsers","NB_RESULTS_LIMIT","then","empty","peopleIds","Object","keys","results","fadeIn","unbind","fadeOut","forEach","profile","peopleId","append","createSearchResultHtml","peopleProfile","profile_picture","full_name","search"],"mappings":"AAAA,a;;AAEAA,OAAOC,SAAP,GAAmBD,OAAOC,SAAP,IAAoB,EAAvC;;AAEA;;;AAGAA,UAAUC,MAAV;;AAEE;;;wFAFF;AAM8B;AAC1B,aAAO,CAAP;AACD;;AAED;;;SAVF;AAcgC;AAC5B,aAAO,EAAP;AACD;;AAED;;SAlBF;AAqBE,oBAAc;AACZ;AACA,SAAKC,QAAL,GAAgBC,SAASD,QAAT,EAAhB;;AAEAE,MAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAM;AACtB;AACA,YAAKC,WAAL,GAAmBH,EAAE,cAAF,CAAnB;AACA,YAAKI,aAAL,GAAqBJ,EAAE,mBAAF,CAArB;;AAEA;AACA,YAAKG,WAAL,CAAiBE,KAAjB,CAAuB,oBAAM,MAAKC,oBAAL,EAAN,EAAvB;AACA,YAAKH,WAAL,CAAiBI,KAAjB,CAAuB,oBAAM,MAAKD,oBAAL,EAAN,EAAvB;AACA,YAAKH,WAAL,CAAiBK,KAAjB,CAAuB,oBAAM,MAAKF,oBAAL,EAAN,EAAvB;AACD,KATD;AAUD;;AAED;;OArCF;AAwCyB;AACrB,UAAMG,eAAe,KAAKN,WAAL,CAAiBO,GAAjB,GAAuBC,WAAvB,GAAqCC,IAArC,EAArB;AACA,UAAIH,aAAaI,MAAb,IAAuBjB,UAAUC,MAAV,CAAiBiB,cAA5C,EAA4D;AAC1DlB,kBAAUG,QAAV,CAAmBgB,WAAnB,CAA+BN,YAA/B,EAA6Cb,UAAUC,MAAV,CAAiBmB,gBAA9D,EAAgFC,IAAhF;AACI,2BAAW;AACT,iBAAKb,aAAL,CAAmBc,KAAnB;AACA,cAAMC,YAAYC,OAAOC,IAAP,CAAYC,OAAZ,CAAlB;AACA,cAAIH,UAAUN,MAAV,GAAmB,CAAvB,EAA0B;AACxB,mBAAKT,aAAL,CAAmBmB,MAAnB;AACAvB,cAAE,MAAF,EAAUQ,KAAV,CAAgB,YAAM;AACpBR,gBAAE,MAAF,EAAUwB,MAAV,CAAiB,OAAjB;AACA,qBAAKpB,aAAL,CAAmBqB,OAAnB;AACD,aAHD;AAIAN,sBAAUO,OAAV,CAAkB,oBAAY;AAC5B,kBAAMC,UAAUL,QAAQM,QAAR,CAAhB;AACA,qBAAKxB,aAAL,CAAmByB,MAAnB;AACIjC,wBAAUC,MAAV,CAAiBiC,sBAAjB,CAAwCF,QAAxC,EAAkDD,OAAlD,CADJ;AAED,aAJD;AAKD,WAXD,MAWO;AACL,mBAAKvB,aAAL,CAAmBqB,OAAnB;AACD;AACF,SAlBL;AAmBD,OApBD,MAoBO;AACL,aAAKrB,aAAL,CAAmBc,KAAnB;AACA,aAAKd,aAAL,CAAmBqB,OAAnB;AACD;AACF;;AAED;;SApEF;AAuEgCG,YAvEhC,EAuE0CG,aAvE1C,EAuEyD;AACrD;AAC0FH,cAD1F;AAE6DG,oBAAcC,eAAd;AACjD,8BAHZ;AAIyDD,oBAAcE,SAJvE;;AAMD,KA9EH;;;AAiFArC,UAAUsC,MAAV,GAAmB,IAAItC,UAAUC,MAAd,EAAnB","file":"search.js","sourcesContent":["'use strict';\n\nwindow.hermesApp = window.hermesApp || {};\n\n/**\n * Handles the Friendly Pix search feature.\n */\nhermesApp.Search = class {\n\n  /**\n   * The minimum number of characters to trigger a search.\n   * @return {number}\n   */\n  static get MIN_CHARACTERS() {\n    return 3;\n  }\n\n  /**\n   * The maximum number of search results to be displayed.\n   * @return {number}\n   */\n  static get NB_RESULTS_LIMIT() {\n    return 10;\n  }\n\n  /**\n   * Initializes the Friendly Pix search bar.\n   */\n  constructor() {\n    // Firebase SDK.\n    this.database = firebase.database();\n\n    $(document).ready(() => {\n      // DOM Elements pointers.\n      this.searchField = $('#searchQuery');\n      this.searchResults = $('#hm-searchResults');\n\n      // Event bindings.\n      this.searchField.keyup(() => this.displaySearchResults());\n      this.searchField.focus(() => this.displaySearchResults());\n      this.searchField.click(() => this.displaySearchResults());\n    });\n  }\n\n  /**\n   * Display search results.\n   */\n  displaySearchResults() {\n    const searchString = this.searchField.val().toLowerCase().trim();\n    if (searchString.length >= hermesApp.Search.MIN_CHARACTERS) {\n      hermesApp.firebase.searchUsers(searchString, hermesApp.Search.NB_RESULTS_LIMIT).then(\n          results => {\n            this.searchResults.empty();\n            const peopleIds = Object.keys(results);\n            if (peopleIds.length > 0) {\n              this.searchResults.fadeIn();\n              $('html').click(() => {\n                $('html').unbind('click');\n                this.searchResults.fadeOut();\n              });\n              peopleIds.forEach(peopleId => {\n                const profile = results[peopleId];\n                this.searchResults.append(\n                    hermesApp.Search.createSearchResultHtml(peopleId, profile));\n              });\n            } else {\n              this.searchResults.fadeOut();\n            }\n          });\n    } else {\n      this.searchResults.empty();\n      this.searchResults.fadeOut();\n    }\n  }\n\n  /**\n   * Returns the HTML for a single search result\n   */\n  static createSearchResultHtml(peopleId, peopleProfile) {\n    return `\n        <a class=\"hm-searchResultItem hm-usernamelink mdl-button mdl-js-button\" href=\"/user/${peopleId}\">\n            <div class=\"hm-avatar\"style=\"background-image: url(${peopleProfile.profile_picture ||\n                '/images/silhouette.jpg'})\"></div>\n            <div class=\"hm-username mdl-color-text--black\">${peopleProfile.full_name}</div>\n        </a>`;\n  }\n};\n\nhermesApp.search = new hermesApp.Search();\n"]}